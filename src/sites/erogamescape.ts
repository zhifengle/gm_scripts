import { SearchResult, Subject } from '../interface/subject';
import { $q } from '../utils/domUtils';
import { fetchText } from '../utils/fetchData';
import { normalizeQuery } from '../utils/utils';
import { filterResults } from './common';

enum ErogamescapeCategory {
  game = 'game',
  brand = 'brand',
  creater = 'creater',
  music = 'music',
  pov = 'pov',
  character = 'character',
}
export const favicon = 'data:image/x-icon;base64,AAABAAEAQEAAAAEAIAAoQgAAFgAAACgAAABAAAAAgAAAAAEAIAAAAAAAAEAAABILAAASCwAAAAAAAAAAAABDmAD/Q5gA/0OYAP9DmAD/Q5gA/0OYAP9DmAD/Q5gA/0OYAP9DmAD/Q5gA/0OYAP9DmAD/Q5gA/0OYAP9DmAD/Q5gA/0OYAP9DmAD/Q5gA/0OYAP9DmAD/Q5gA/0OYAP9GmQD/RpkB/0SZAf9FmAD///////////////////////////////////////////9DmQD/RJoA/0WYAP9DmAD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RZgA/0WYAP9FmAD/RZgA/0WYAP9FmAD/RZgA/0WYAP9FmAD/RZgA/0WYAP9FmAD/RZgA/0WYAP9FmAD/RZgA/0WYAP9FmAD/RZgA/0WYAP9FmAD/RZgA/0WYAP9FmAD/RpkB/0KZAf9DmQD/Q5kA///+//////////////3/////////////////////////Q5kA/0SaAP9FmAD/Q5gA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SZAf9EmQH/RJkB/0SZAf9EmQH/RJkB/0SZAf9EmQH/RJkB/0SZAf9EmQH/RJkB/0SZAf9EmQH/RJkB/0SZAf9EmQH/RJkB/0SZAf9EmQH/RJkB/0SZAf9EmQH/RJkB/0SZAf9DmQD/RpkB/0OYAP///////f///////////////////////////////////0OZAP9EmgD/RZgA/0OYAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9DmQD/Q5kA/0OZAP9DmQD/Q5kA/0OZAP9DmQD/Q5kA/0OZAP9DmQD/Q5kA/0OZAP9DmQD/Q5kA/0OZAP9DmQD/Q5kA/0OZAP9DmQD/Q5kA/0OZAP9DmQD/Q5kA/0OZAP9FmAD/Q5kA/0OYAP9GmQD///7//////////v////////////////////////////9DmQD/RJoA/0WYAP9DmAD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////+//////////7//////v/9///////+////////////////////////////Q5kA/0SaAP9FmAD/Q5gA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////f/////////9//////7//////////v///////////////////////0OZAP9EmgD/RZgA/0OYAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////v/////+///////9//7///////////////////////////9DmQD/RJoA/0WYAP9DmAD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////3//////////////////////v//////////////////////////////////Q5kA/0SaAP9FmAD/Q5gA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////3////////////////////////////+/////////////////////////////////0WYAP9EmQH/RpkB/0aZAP9DmAD/Q5gA/0OYAP9DmAD/Q5gA/0OYAP9DmAD/Q5gA/0WYAP9FmAD/RJkB/0WYAP9GmQD/RpkA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9//7///7////////9//////////3////////////////+//9DmQD/Q5kA/0KZAf9GmQH/RZgA/0WYAP9FmAD/RZgA/0WYAP9FmAD/RZgA/0WYAP9DmAD/QpoA/0OYAP9DmQD/RJkB/0SaAP9GmQH/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9//7//////////v////////////3/////////Q5gA/0aZAf9DmQD/RJkB/0SZAf9EmQH/RJkB/0SZAf9EmQH/RJkB/0SZAf9EmQH/RJkB/0WYAP9GmQH/QZkA/0aZAP9EmgD/RJkB/0aZAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////7///////7//f///v/////////+///////////////+//////////7//0aZAP9DmAD/Q5kA/0WYAP9DmQD/Q5kA/0OZAP9DmQD/Q5kA/0OZAP9DmQD/Q5kA/0OYAP9FmAD/Q5gA/0SbAP9FlwL/RpkA/0SZAf9GmQD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIr//wCL//8BjP///v/9///////9//7///////////////7//f///////v///v/////////+/////////////////////////////////////////////////////////////////////v//RJsA/0GZAP9DmQD/RZgA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//////////////////////////v/////////+///9//////////3////////////////////////////////////////////////////////////////////9/////////0OYAP9GmQH/Q5gA/0SZAf9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai/7/AIv//wCK//////7///////////////////////3//v/////////+///+//////////////////////////////////////////////////////////////////////////////////9FmAD/RZgA/0KaAP9FmAD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Civ//AIv//wCL//8AjP///////////////////f////////////////7///////////////////3////////////////////////////////////////////////////9////////////////////Q5gA/0SZAf9DmAD/RZgA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv////////////////////////////////////+///////////////////9/////////////////////////////////////////////////////f///////////////////0OYAP9EmQH/Q5gA/0WYAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//////////////////////////////3//v/////////+///+//////////////////////////////////////////////////////////////////////////////////9FmAD/RZgA/0KaAP9FmAD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai//////////////////////////+//////////7///3//////////f////////////////////////////////////////////////////////////////////3/////////Q5gA/0aZAf9DmAD/RJkB/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv////////////////////////////////+//3///////7///7//////////v////////////////////////////////////////////////////////////////////7//0SbAP9BmQD/Q5kA/0WYAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL///////////////////////////////+//////////7//0aZAP9DmAD/Q5kA/0WYAP9DmQD/Q5kA/0OZAP9DmQD/Q5kA/0OZAP9DmQD/Q5kA/0OYAP9FmAD/Q5gA/0SbAP9FlwL/RpkA/0SZAf9GmQD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai////////////////////////////////////f////////9DmAD/RpkB/0OZAP9EmQH/RJkB/0SZAf9EmQH/RJkB/0SZAf9EmQH/RJkB/0SZAf9EmQH/RZgA/0aZAf9BmQD/RpkA/0SaAP9EmQH/RpkA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv////////////////////////9/////////////////v//Q5kA/0OZAP9CmQH/RpkB/0WYAP9FmAD/RZgA/0WYAP9FmAD/RZgA/0WYAP9FmAD/Q5gA/0KaAP9DmAD/Q5kA/0SZAf9EmgD/RpkB/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL/////////////////////////////////////////////0WYAP9EmQH/RpkB/0aZAP9DmAD/Q5gA/0OYAP9DmAD/Q5gA/0OYAP9DmAD/Q5gA/0WYAP9FmAD/RJkB/0WYAP9GmQD/RpkA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9DmQD/RJoA/0WYAP9DmAD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////Q5kA/0SaAP9FmAD/Q5gA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////0OZAP9EmgD/RZgA/0OYAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9DmQD/RJoA/0WYAP9DmAD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////Q5kA/0SaAP9FmAD/Q5gA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////0OZAP9EmgD/RZgA/0OYAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9DmQD/RJoA/0WYAP9DmAD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////Q5kA/0SaAP9FmAD/Q5gA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//////////////////////////////////////////////////////////////////0OZAP9EmgD/RZgA/0OYAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA//////////////////////////////////////////////////////////////////////////////////////8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//////////////////////////////////////////////////////////////////9DmQD/RJoA/0WYAP9DmAD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP//////////////////////////////////////////////////////////////////////////////////////AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///////////////////////////////////////////////////////////////////Q5kA/0SaAP9FmAD/Q5gA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD//////////////////////////////////////////////////////////////////////////////////////wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//////////////////////////////////////////////////////////////////0OZAP9EmgD/RZgA/0OYAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA//////////////////////////////////////////////////////////////////////////////////////8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//////////////////////////////////////////////////////////////////9DmQD/RJoA/0WYAP9DmAD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP//////////////////////////////////////////////////////////////////////////////////////AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///////////////////////////////////////////////////////////////////Q5kA/0SaAP9FmAD/Q5gA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD//////////////////////////////////////////////////////////////////////////////////////wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//////////////////////////////////////////////////////////////////0OZAP9EmgD/RZgA/0OYAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA//////////////////////////////////////////////////////////////////////////////////////8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//////////////////////////////////////////////////////////////////9DmQD/RJoA/0WYAP9DmAD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP//////////////////////////////////////////////////////////////////////////////////////AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8AjP//AIv//wCL//8Aiv7/AIv//wCL//8Ai///Aor//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///////////////////////////////////////////////////////////////////Q5kA/0SaAP9FmAD/Q5gA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wKL//8Ai///AIz9/wGJ//8Ai///AIr//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//////////////////////////////////////////////////////////////////0OZAP9EmgD/RZgA/0OYAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///Aor//wCL//8Aiv//AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//////////////////////////////////////////////////////////////////9DmQD/RJoA/0WYAP9DmAD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIz9/wCL//8Ai/z/AIv//wCL//8Aiv//AIz//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///////////////////////////////////////////////////////////////////Q5kA/0SaAP9FmAD/Q5gA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wGJ//8Ai///AIv///7//f/////////////+/v///////////////////////////////////////////////////////////////////////////////////////////////////////////0OZAP9EmgD/RZgA/0OYAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////9DmQD/RJoA/0WYAP9DmAD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIr//wCL//8Aiv//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////Q5kA/0SaAP9FmAD/Q5gA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///Aor//wCL//8Ai///AIz////+/v////////////3//v///////////////////////////////////////////////////////////////////////////////////////////////////////////0OZAP9EmgD/RZgA/0OYAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP9EmgD/RJoA/0SaAP8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wKK//8Ai///AIv//wCM/////v7////////////9//7////////////////////////////////////////////9/////////////////////////////v////////////////////////////////9FmAD/RJkB/0aZAf9GmQD/Q5gA/0OYAP9DmAD/Q5gA/0OYAP9DmAD/Q5gA/0OYAP9DmAD/Q5gA/0OYAP9DmAD/Q5gA/0OYAP9DmAD/Q5gA/0OYAP9DmAD/Q5gA/0OYAP9DmAD/Q5gA/0OYAP9DmAD/AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIr//wCL//8Aiv///////////////////////////////////////////////////////////////////////////////////f/+///+/////////f/////////9/////////////////v//Q5kA/0OZAP9CmQH/RpkB/0WYAP9FmAD/RZgA/0WYAP9FmAD/RZgA/0WYAP9FmAD/RZgA/0WYAP9FmAD/RZgA/0WYAP9FmAD/RZgA/0WYAP9FmAD/RZgA/0WYAP9FmAD/RZgA/0WYAP9FmAD/RZgA/wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//////////////////////////////////////////////////////////////////////////////////////////////f/+//////////7////////////9/////////0OYAP9GmQH/Q5kA/0SZAf9EmQH/RJkB/0SZAf9EmQH/RJkB/0SZAf9EmQH/RJkB/0SZAf9EmQH/RJkB/0SZAf9EmQH/RJkB/0SZAf9EmQH/RJkB/0SZAf9EmQH/RJkB/0SZAf9EmQH/RJkB/0SZAf8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Bif//AIv//wCL///+//3//////////////v7////////////////////////////////////////////////////+///////+//3///7//////////v///////////////v/////////+//9GmQD/Q5gA/0OZAP9FmAD/Q5kA/0OZAP9DmQD/Q5kA/0OZAP9DmQD/Q5kA/0OZAP9DmQD/Q5kA/0OZAP9DmQD/Q5kA/0OZAP9DmQD/Q5kA/0OZAP9DmQD/Q5kA/0OZAP9DmQD/Q5kA/0OZAP9DmQD/AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIz9/wCL//8Ai/z/AIv//wCL//8Aiv//AIz//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCK//8Ai///AYz///7//f///////f/+///////////////+//3///////7///7//////////v///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Civ//AIv//wCK//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//////////////////////////7//////////v///f/////////9//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ci///AIv//wCM/f8Bif//AIv//wCK//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv+/wCL//8Aiv/////+///////////////////////9//7//////////v///v//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8AjP//AIv//wCL//8Aiv7/AIv//wCL//8Ai///Aor//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///Aor//wCL//8Ai///AIz///////////////////3////////////////+///////////////////9/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//////////////////////////////////////7///////////////////////3///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai//////////////////////////////9///////////+///9//7/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv///////////////////////////7///////3//v///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL///////////////////////////////+//////////7///7//f/////////+//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai//////////////////////////////9//7///////7//f8BjP//AIv//wCK//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv/////////////////////////////////////////////AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL///////////////////////////////////////////+/wCK//8Ai///AIv+/wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai/////////////////////////3///////////////////8AjP//AIv//wCL//8Civ//AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AIv//wCL//8Ai///AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=';

// 'http://erogamescape.org',
const site_origin = 'https://erogamescape.org';

function getSearchItem($item: HTMLElement): SearchResult {
  const $title = $item.querySelector('td:nth-child(1) > a');
  const href = $title.getAttribute('href');
  const info: SearchResult = {
    name: $title.textContent,
    url: href,
    count: $item.querySelector('td:nth-child(6)')?.textContent ?? 0,
    score: $item.querySelector('td:nth-child(4)')?.textContent ?? 0,
    releaseDate: $item.querySelector('td:nth-child(3)').textContent,
  };
  return info;
}

export async function searchSubject(
  subjectInfo: Subject,
  type: ErogamescapeCategory = ErogamescapeCategory.game,
  uniqueQueryStr: string = ''
): Promise<SearchResult> {
  let query = normalizeQuery((subjectInfo.name || '').trim());
  if (uniqueQueryStr) {
    query = uniqueQueryStr;
  }
  if (!query) {
    console.info('Query string is empty');
    return;
  }
  const url = `${site_origin}/~ap2/ero/toukei_kaiseki/kensaku.php?category=${type}&word_category=name&word=${encodeURIComponent(
    query
  )}&mode=normal`;
  console.info('search subject URL: ', url);
  const rawText = await fetchText(url);
  const $doc = new DOMParser().parseFromString(rawText, 'text/html');
  const items = $doc.querySelectorAll('#result table tr:not(:first-child)');
  const rawInfoList: SearchResult[] = [...items].map(($item: HTMLElement) =>
    getSearchItem($item)
  );
  const res = filterResults(
    rawInfoList,
    subjectInfo,
    {
      keys: ['name'],
    },
    true
  );
  console.info(`Search result of ${query} on erogamescape: `, res);
  if (res && res.url) {
    // 相对路径需要设置一下
    res.url = new URL(res.url, url).href;
    return res;
  }
}

export function searchGameSubject(info: Subject): Promise<SearchResult> {
  return searchSubject(info, ErogamescapeCategory.game);
}

export function getSearchResult(): SearchResult {
  const $title = $q('#soft-title > .bold');
  const info: SearchResult = {
    name: $title.textContent.trim(),
    score: $q('#average > td')?.textContent.trim() ?? 0,
    count: $q('#count > td')?.textContent.trim() ?? 0,
    url: location.href,
  };
  return info;
}
